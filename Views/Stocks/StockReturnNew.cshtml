@{
    ViewBag.Title = "StockReturnNew";
}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

<div class="container-fluid mt-3">
    <h2>STOCK RETURN</h2>

    <div class="form-group mt-4">
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="returnType" id="customerReturn" value="customer">
            <label class="form-check-label" for="customerReturn">Customer</label>
        </div>
        <div class="form-check form-check-inline">
            <input class="form-check-input" type="radio" name="returnType" id="supplierReturn" value="supplier" checked>
            <label class="form-check-label" for="supplierReturn">Supplier</label>
        </div>
    </div>

    <div class="row mt-3">
        <div class="col-md-6">
            <div class="form-group row">
                <label class="col-sm-3 col-form-label">Returned By:</label>
                <div class="col-sm-9">
                    <select class="form-control">
                        <option selected disabled>Select</option>
                        <option>Supplier 1</option>
                        <option>Supplier 2</option>
                        <option>Supplier 3</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group row">
                <label class="col-sm-3 col-form-label">Date:</label>
                <div class="col-sm-9">
                    <input type="date" class="form-control" placeholder="mm/dd/yyyy">
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-12">
            <div class="form-group row">
                <label class="col-sm-1 col-form-label">Notes:</label>
                <div class="col-sm-11">
                    <input type="text" class="form-control">
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12 text-right mb-3">
            <button type="button" class="btn btn-outline-dark mr-2" id="selectFromDRBtn">
                <i class="bi bi-plus-circle"></i> Select from DR
            </button>
            <button type="button" class="btn btn-outline-dark" id="selectProductBtn">
                <i class="bi bi-plus-circle"></i> Select Product
            </button>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table table-bordered">
            <thead class="thead-light">
                <tr>
                    <th>Product</th>
                    <th>Batch code</th>
                    <th>Quantity</th>
                    <th>Notes</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="productTableBody">
                <tr>
                    <td>Derma Facial Kit</td>
                    <td>TFR2022019</td>
                    <td><input type="number" class="form-control quantity-input" value="0"></td>
                    <td><input type="text" class="form-control"></td>
                    <td>
                        <button class="btn btn-sm btn-outline-danger remove-product">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                </tr>
            </tbody>
            <tfoot>
                <tr>
                    <td colspan="2" class="text-right font-weight-bold">Total:</td>
                    <td id="totalQuantity" class="font-weight-bold">0</td>
                    <td colspan="2"></td>
                </tr>
            </tfoot>
        </table>
    </div>

    <div class="row mt-4">
        <div class="col-12 text-right">
            <button type="button" class="btn btn-success mr-2">Save</button>
            <button type="button" class="btn btn-danger">Cancel</button>
        </div>
    </div>
</div>

<!-- Select from DR Modal -->
<div class="modal fade" id="selectFromDRModal" tabindex="-1" role="dialog" aria-labelledby="selectFromDRModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="selectFromDRModalLabel">SELECT ITEMS</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row mb-3">
                    <div class="col-md-3">
                        <input type="text" class="form-control" placeholder="DR Date From">
                    </div>
                    <div class="col-md-3">
                        <input type="text" class="form-control" placeholder="DR Date To">
                    </div>
                    <div class="col-md-2">
                        <input type="text" class="form-control" placeholder="DR#">
                    </div>
                    <div class="col-md-2">
                        <input type="text" class="form-control" placeholder="Batch code">
                    </div>
                    <div class="col-md-2">
                        <input type="text" class="form-control" placeholder="Product">
                    </div>
                </div>

                <div class="text-right mb-3">
                    <button type="button" class="btn btn-primary" id="drSearchBtn">
                        <i class="bi bi-search"></i> Search
                    </button>
                </div>

                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead class="thead-light">
                            <tr>
                                <th>Product Description</th>
                                <th>DR #</th>
                                <th>DR Date</th>
                                <th>batch code</th>
                                <th>Pcs</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Premium tinted sunscreen</td>
                                <td>1001</td>
                                <td>04-04-2025</td>
                                <td>TFR2022019</td>
                                <td>1,000</td>
                                <td><a href="#" class="select-dr-item">select</a></td>
                            </tr>
                            <tr>
                                <td>Premium tinted sunscreen</td>
                                <td>1001</td>
                                <td>04-04-2025</td>
                                <td>TFR2022020</td>
                                <td>500</td>
                                <td><a href="#" class="select-dr-item">select</a></td>
                            </tr>
                            <tr>
                                <td>Premium tinted sunscreen</td>
                                <td>1005</td>
                                <td>04-15-2025</td>
                                <td>TFR2022315</td>
                                <td>1,000</td>
                                <td><a href="#" class="select-dr-item">select</a></td>
                            </tr>
                            <tr>
                                <td>Premium tinted sunscreen</td>
                                <td>1005</td>
                                <td>04-15-2025</td>
                                <td>TFR2022316</td>
                                <td>500</td>
                                <td><a href="#" class="select-dr-item">select</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Product Selection Modal -->
<div class="modal fade" id="selectProductModal" tabindex="-1" role="dialog" aria-labelledby="selectProductModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="selectProductModalLabel">SELECT ITEMS</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p class="small text-muted">** All Products / group product / Individual Products</p>
                <div class="row mb-3">
                    <div class="col-md-8">
                        <input type="text" class="form-control" placeholder="Search product">
                    </div>
                    <div class="col-md-4">
                        <select class="form-control">
                            <option>All Products</option>
                            <option>Group Only</option>
                            <option>Individual Only</option>
                        </select>
                    </div>
                </div>

                <div class="text-right mb-3">
                    <button type="button" class="btn btn-primary" id="productSearchBtn">
                        <i class="bi bi-search"></i> Search
                    </button>
                </div>

                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead class="thead-light">
                            <tr>
                                <th>Product Description</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Derma Facial Kit</td>
                                <td><a href="#" class="select-product" data-product="Derma Facial Kit">select</a></td>
                            </tr>
                            <tr>
                                <td>Premium Tinted Sunscreen 50g</td>
                                <td><a href="#" class="select-product" data-product="Premium Tinted Sunscreen 50g">select</a></td>
                            </tr>
                            <tr>
                                <td>Derma Facial Toner 60ml</td>
                                <td><a href="#" class="select-product" data-product="Derma Facial Toner 60ml">select</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    $(document).ready(function () {
        // Calculate total on page load
        calculateTotal();

        // Open DR selection modal
        $('#selectFromDRBtn').click(function () {
            $('#selectFromDRModal').modal('show');
        });

        // Open product selection modal
        $('#selectProductBtn').click(function () {
            $('#selectProductModal').modal('show');
        });

        // Handle selecting an item from DR
        $(document).on('click', '.select-dr-item', function (e) {
            e.preventDefault();

            // Get the product details from the row
            const $row = $(this).closest('tr');
            const product = $row.find('td:eq(0)').text();
            const drNumber = $row.find('td:eq(1)').text();
            const batchCode = $row.find('td:eq(3)').text();
            const quantity = $row.find('td:eq(4)').text().replace(',', '');

            // Add the product to the main table
            addProductToTable(product, batchCode, quantity, '');

            // Close the modal
            $('#selectFromDRModal').modal('hide');
        });

        // Handle selecting a product
        $(document).on('click', '.select-product', function (e) {
            e.preventDefault();

            // Get the product name
            const product = $(this).data('product');

            // Add the product to the main table with empty values
            addProductToTable(product, '', '0', '');

            // Close the modal
            $('#selectProductModal').modal('hide');
        });

        // Function to add product to the main table
        function addProductToTable(product, batchCode, quantity, notes) {
            const html = `
                <tr>
                    <td>${product}</td>
                    <td>${batchCode}</td>
                    <td><input type="number" class="form-control quantity-input" value="${quantity}"></td>
                    <td><input type="text" class="form-control" value="${notes}"></td>
                    <td>
                        <button class="btn btn-sm btn-outline-danger remove-product">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                </tr>
            `;

            $('#productTableBody').append(html);

            // Recalculate total after adding product
            calculateTotal();

            // Add event listener to new quantity input
            $('.quantity-input').off('input').on('input', function () {
                calculateTotal();
            });
        }

        // Handle removing a product
        $(document).on('click', '.remove-product', function () {
            $(this).closest('tr').remove();
            calculateTotal();
        });

        // Calculate total quantity
        function calculateTotal() {
            let total = 0;
            $('.quantity-input').each(function () {
                const value = parseInt($(this).val()) || 0;
                total += value;
            });
            $('#totalQuantity').text(total.toLocaleString());
        }

        // Listen for changes in quantity inputs
        $(document).on('input', '.quantity-input', function () {
            calculateTotal();
        });
    });
</script>