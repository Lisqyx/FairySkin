@{
    ViewBag.Title = "BranchTransferNew";
}

<link href="~/Content/BranchTransferNew.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">

<div class="container-fluid mt-3">
    <h2>BRANCH TRANSFER - OUT</h2>

    <div class="row mt-4">
        <div class="col-md-6">
            <div class="form-group row">
                <label class="col-sm-3 col-form-label">Branch:</label>
                <div class="col-sm-9">
                    <select class="form-control">
                        <option selected disabled>Select Branch</option>
                        <option>Branch 1</option>
                        <option>Branch 2</option>
                        <option>Branch 3</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group row">
                <label class="col-sm-3 col-form-label">Date:</label>
                <div class="col-sm-9">
                    <input type="date" class="form-control" placeholder="mm/dd/yyyy">
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-md-6">
            <div class="form-group row">
                <label class="col-sm-3 col-form-label">Notes:</label>
                <div class="col-sm-9">
                    <input type="text" class="form-control">
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="form-group row">
                <label class="col-sm-3 col-form-label">Invoice No.:</label>
                <div class="col-sm-9">
                    <input type="text" class="form-control">
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12 text-right mb-3">
            <button type="button" class="btn btn-outline-dark rounded add-btn" id="selectProductBtn">
                <i class="bi bi-plus-circle"></i> Select Product
            </button>
        </div>
    </div>

    <div id="productCards">
        <!-- Product card will be added here -->
        <div class="card product-card mb-3">
            <div class="card-header" style="background-color: #e0a7a7;">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="product-title mb-0">DERMA FACIAL KIT</h5>
                    <button type="button" class="btn btn-link text-danger delete-product">Delete</button>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="product-item mb-3 p-3 border-bottom">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="mb-0">Derma Facial Toner 60ml</h6>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary edit-product">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger remove-product">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-bordered mb-0">
                            <thead>
                                <tr>
                                    <th>Batch code</th>
                                    <th>Expiration date</th>
                                    <th>Location</th>
                                    <th>Packaging</th>
                                    <th>Quantity</th>
                                    <th>No. of Pcs</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>FTR241103</td>
                                    <td>2026-11-03</td>
                                    <td>ALVL1B1P1</td>
                                    <td>10</td>
                                    <td>1</td>
                                    <td>10</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="product-item mb-3 p-3 border-bottom">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="mb-0">Derma Brightening cream 10g</h6>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary edit-product">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger remove-product">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-bordered mb-0">
                            <thead>
                                <tr>
                                    <th>Batch code</th>
                                    <th>Expiration date</th>
                                    <th>Location</th>
                                    <th>Packaging</th>
                                    <th>Quantity</th>
                                    <th>No. of Pcs</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>FTR241103</td>
                                    <td>2026-11-03</td>
                                    <td>ALVL1B1P1</td>
                                    <td>10</td>
                                    <td>1</td>
                                    <td>10</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="product-item mb-3 p-3 border-bottom">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="mb-0">Derma sunscreen Gel Cream 10g</h6>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary edit-product">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger remove-product">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-bordered mb-0">
                            <thead>
                                <tr>
                                    <th>Batch code</th>
                                    <th>Expiration date</th>
                                    <th>Location</th>
                                    <th>Packaging</th>
                                    <th>Quantity</th>
                                    <th>No. of Pcs</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>FTR241103</td>
                                    <td>2026-11-03</td>
                                    <td>ALVL1B1P1</td>
                                    <td>10</td>
                                    <td>1</td>
                                    <td>10</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="product-item mb-3 p-3 border-bottom">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="mb-0">Derma Soap</h6>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary edit-product">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger remove-product">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-bordered mb-0">
                            <thead>
                                <tr>
                                    <th>Batch code</th>
                                    <th>Expiration date</th>
                                    <th>Location</th>
                                    <th>Packaging</th>
                                    <th>Quantity</th>
                                    <th>No. of Pcs</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>FTR241103</td>
                                    <td>2026-11-03</td>
                                    <td>ALVL1B1P1</td>
                                    <td>10</td>
                                    <td>1</td>
                                    <td>10</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="product-item mb-3 p-3 border-bottom">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="mb-0">Derma set box</h6>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary edit-product">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger remove-product">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-bordered mb-0">
                            <thead>
                                <tr>
                                    <th>Batch code</th>
                                    <th>Expiration date</th>
                                    <th>Location</th>
                                    <th>Packaging</th>
                                    <th>Quantity</th>
                                    <th>No. of Pcs</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>FTR241103</td>
                                    <td>2026-11-03</td>
                                    <td>ALVL1B1P1</td>
                                    <td>10</td>
                                    <td>1</td>
                                    <td>10</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="product-item mb-3 p-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <h6 class="mb-0">Derma blister tray</h6>
                        <div>
                            <button class="btn btn-sm btn-outline-secondary edit-product">
                                <i class="bi bi-pencil"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger remove-product">
                                <i class="bi bi-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-bordered mb-0">
                            <thead>
                                <tr>
                                    <th>Batch code</th>
                                    <th>Expiration date</th>
                                    <th>Location</th>
                                    <th>Packaging</th>
                                    <th>Quantity</th>
                                    <th>No. of Pcs</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>FTR241103</td>
                                    <td>2026-11-03</td>
                                    <td>ALVL1B1P1</td>
                                    <td>10</td>
                                    <td>1</td>
                                    <td>10</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12 text-right">
            <button type="button" class="btn btn-success mr-2">Save</button>
            <button type="button" class="btn btn-danger">Cancel</button>
        </div>
    </div>
</div>

<!-- Product Selection Modal -->
<div class="modal fade" id="selectItemsModal" tabindex="-1" role="dialog" aria-labelledby="selectItemsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="selectItemsModalLabel">SELECT ITEMS</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="row mb-3">
                    <div class="col-md-8">
                        <input type="text" class="form-control" placeholder="Search item">
                    </div>
                    <div class="col-md-4">
                        <select class="form-control">
                            <option>All products</option>
                            <option>Group Only</option>
                            <option>Individual Only</option>
                        </select>
                    </div>
                </div>

                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead class="thead-light">
                            <tr>
                                <th>Item Description</th>
                                <th>Stocks</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Derma Facial Kit</td>
                                <td></td>
                                <td><a href="#" class="select-item" data-item="Derma Facial Kit">select</a></td>
                            </tr>
                            <tr>
                                <td>Derma facial toner 60ml</td>
                                <td>10,503</td>
                                <td><a href="#" class="select-item" data-item="Derma facial toner 60ml">select</a></td>
                            </tr>
                            <tr>
                                <td>Derma Brightening Cream 10g</td>
                                <td>10,500</td>
                                <td><a href="#" class="select-item" data-item="Derma Brightening Cream 10g">select</a></td>
                            </tr>
                            <tr>
                                <td>Derma sunscreen Gel Cream 10g</td>
                                <td>10,500</td>
                                <td><a href="#" class="select-item" data-item="Derma sunscreen Gel Cream 10g">select</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Template for adding new product item -->
<template id="productItemTemplate">
    <div class="product-item mb-3 p-3 border-bottom">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <h6 class="mb-0">Product Name</h6>
            <div>
                <button class="btn btn-sm btn-outline-secondary edit-product">
                    <i class="bi bi-pencil"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger remove-product">
                    <i class="bi bi-trash"></i>
                </button>
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-bordered mb-0">
                <thead>
                    <tr>
                        <th>Batch code</th>
                        <th>Expiration date</th>
                        <th>Location</th>
                        <th>Packaging</th>
                        <th>Quantity</th>
                        <th>No. of Pcs</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>FTR241103</td>
                        <td>2026-11-03</td>
                        <td>ALVL1B1P1</td>
                        <td>10</td>
                        <td>1</td>
                        <td>10</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</template>

<!-- Template for new product card -->
<template id="productCardTemplate">
    <div class="card product-card mb-3">
        <div class="card-header" style="background-color: #e0a7a7;">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="product-title mb-0">PRODUCT NAME</h5>
                <button type="button" class="btn btn-link text-danger delete-product">Delete</button>
            </div>
        </div>
        <div class="card-body p-0">
            <!-- Product items will be added here -->
        </div>
    </div>
</template>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
    $(document).ready(function () {
        // Open modal when clicking Select Product button
        $('#selectProductBtn').click(function () {
            $('#selectItemsModal').modal('show');
        });

        // Make sure the close button works in the modal
        $('.close').click(function () {
            $(this).closest('.modal').modal('hide');
        });

        // For existing delete buttons
        $(document).on('click', '.delete-product', function () {
            $(this).closest('.product-card').remove();
        });

        // For existing edit buttons
        $(document).on('click', '.edit-product', function () {
            $('#selectItemsModal').modal('show');
        });

        // For existing remove buttons
        $(document).on('click', '.remove-product', function () {
            $(this).closest('.product-item').remove();

            // If no more items in the card, remove the entire card
            const $parentCard = $(this).closest('.product-card');
            if ($parentCard.find('.product-item').length === 0) {
                $parentCard.remove();
            }
        });

        // Handle clicking "select" for a product
        $(document).on('click', '.select-item', function (e) {
            e.preventDefault();
            const selectedItem = $(this).data('item');

            let cardExists = false;
            let $targetCard = null;

            // Check if the card for this item already exists
            $('.product-title').each(function () {
                if ($(this).text() === selectedItem) {
                    cardExists = true;
                    $targetCard = $(this).closest('.product-card');
                }
            });

            if (!cardExists) {
                // Create a new product card
                const $newCard = $(document.getElementById('productCardTemplate').content.cloneNode(true));
                $newCard.find('.product-title').text(selectedItem);
                $('#productCards').append($newCard);
                $targetCard = $('#productCards .product-card').last();
            }

            // Create a new product item
            const $newItem = $(document.getElementById('productItemTemplate').content.cloneNode(true));
            $newItem.find('h6').text(selectedItem);

            // Append the item to the card
            $targetCard.find('.card-body').append($newItem);

            // Close the selection modal
            $('#selectItemsModal').modal('hide');
        });
    });
</script>